<!-- Enhanced Spectacular Project Modal -->
<div 
  *ngIf="isOpen && project"
  class="modal-backdrop fixed inset-0 z-50 flex items-center justify-center p-4"
  [@backdropAnimation]="modalState()"
  (click)="onBackdropClick($event)"
>
  <!-- Floating Particles Background -->
  <div class="modal-particles absolute inset-0 pointer-events-none">
    <div class="particle" style="left: 15%; top: 20%; animation-delay: 0s;"></div>
    <div class="particle" style="left: 85%; top: 30%; animation-delay: 1s;"></div>
    <div class="particle" style="left: 25%; top: 70%; animation-delay: 2s;"></div>
    <div class="particle" style="left: 75%; top: 60%; animation-delay: 3s;"></div>
    <div class="particle" style="left: 45%; top: 15%; animation-delay: 4s;"></div>
  </div>

  <!-- Modal Container - Enhanced Centering -->
  <div 
    #modalContainer
    class="modal-container w-full max-w-6xl max-h-[90vh] relative overflow-hidden overflow-y-auto"
    [@modalAnimation]="{
      value: modalState(),
      params: getAnimationParams()
    }"
    (click)="$event.stopPropagation()"
    data-aos="zoom-in"
    data-aos-duration="400"
  >
    
    <!-- Close Button -->
    <button
      (click)="close()"
      class="modal-close-btn absolute top-4 right-4 z-10 w-12 h-12 rounded-full bg-black/20 backdrop-blur-lg text-white hover:bg-black/40 transition-all duration-300 flex items-center justify-center text-xl font-bold border border-white/20 hover:scale-110 hover:rotate-90"
      aria-label="Cerrar modal"
    >
      ‚úï
    </button>

    <!-- Project Navigation -->
    <div class="absolute top-4 left-4 z-10 flex gap-2">
      <button
        *ngIf="hasPreviousProject()"
        (click)="navigateToPrevious()"
        class="nav-btn w-12 h-12 rounded-full bg-black/20 backdrop-blur-lg text-white hover:bg-black/40 transition-all duration-300 flex items-center justify-center border border-white/20 hover:scale-110"
        [title]="'Anterior: ' + previousProject()?.title"
      >
        ‚Üê
      </button>
      <button
        *ngIf="hasNextProject()"
        (click)="navigateToNext()"
        class="nav-btn w-12 h-12 rounded-full bg-black/20 backdrop-blur-lg text-white hover:bg-black/40 transition-all duration-300 flex items-center justify-center border border-white/20 hover:scale-110"
        [title]="'Siguiente: ' + nextProject()?.title"
      >
        ‚Üí
      </button>
    </div>

    <!-- Modal Content -->
    <div class="modal-content rounded-3xl overflow-hidden shadow-2xl">
      
      <!-- Image Gallery Section - Enhanced Focus -->
      <div class="relative h-80 sm:h-96 lg:h-[450px] xl:h-[500px] overflow-hidden bg-black/20 backdrop-blur-sm">
        
        <!-- Main Image -->
        <div class="relative w-full h-full group">
          <img
            [src]="currentImage()?.url"
            [alt]="currentImage()?.alt || project.title"
            class="modal-image w-full h-full object-cover transition-all duration-700"
            (load)="onImageLoad()"
            (error)="onImageError()"
            (loadstart)="onImageStart()"
          >
          
          <!-- Image Loading Overlay -->
          <div 
            *ngIf="isImageLoading()" 
            class="absolute inset-0 bg-black/80 flex items-center justify-center backdrop-blur-md z-20"
          >
            <div class="loading-spinner w-16 h-16 border-4 border-white/20 border-t-white rounded-full animate-spin"></div>
            <div class="absolute inset-0 bg-gradient-to-br from-purple-600/20 to-blue-600/20 animate-pulse"></div>
          </div>

          <!-- Holographic Border Effect -->
          <div class="modal-image-border absolute inset-0 opacity-0 group-hover:opacity-100 transition-opacity duration-300"></div>

          <!-- Featured Badge -->
          <div 
            *ngIf="project.featured" 
            class="featured-badge absolute top-6 left-6 bg-gradient-to-r from-yellow-400 via-yellow-500 to-orange-500 text-white text-sm font-bold px-4 py-2 rounded-full shadow-xl border border-yellow-300/30 z-10"
          >
            ‚≠ê Proyecto Destacado
          </div>

          <!-- Category Badge -->
          <div 
            *ngIf="getCategoryInfo(project) as categoryInfo"
            class="category-badge absolute top-6 right-6 text-white text-sm font-semibold px-4 py-2 rounded-full shadow-xl border border-white/20 z-10"
            [class]="categoryInfo.color"
          >
            {{ categoryInfo.icon }} {{ categoryInfo.label }}
          </div>

          <!-- Image Navigation Arrows -->
          <div *ngIf="hasMultipleImages()" class="absolute inset-0 flex items-center justify-between px-4 pointer-events-none">
            <button
              (click)="previousImage()"
              class="image-nav-btn pointer-events-auto w-12 h-12 rounded-full bg-black/40 backdrop-blur-lg text-white hover:bg-black/60 transition-all duration-300 flex items-center justify-center text-xl border border-white/20 hover:scale-110"
            >
              ‚Äπ
            </button>
            <button
              (click)="nextImage()"
              class="image-nav-btn pointer-events-auto w-12 h-12 rounded-full bg-black/40 backdrop-blur-lg text-white hover:bg-black/60 transition-all duration-300 flex items-center justify-center text-xl border border-white/20 hover:scale-110"
            >
              ‚Ä∫
            </button>
          </div>

          <!-- Image Counter -->
          <div 
            *ngIf="hasMultipleImages()" 
            class="absolute bottom-6 left-1/2 transform -translate-x-1/2 bg-black/40 backdrop-blur-lg text-white px-4 py-2 rounded-full text-sm font-medium border border-white/20"
          >
            {{ currentImageIndex() + 1 }} / {{ project.images.length }}
          </div>
        </div>

        <!-- Image Thumbnails -->
        <div 
          *ngIf="hasMultipleImages()" 
          class="absolute bottom-4 right-4 flex gap-2 max-w-64 overflow-x-auto scrollbar-hide"
        >
          <button
            *ngFor="let image of project.images; let i = index"
            (click)="selectImage(i)"
            class="thumbnail-btn flex-shrink-0 w-16 h-16 rounded-lg overflow-hidden border-2 transition-all duration-300"
            [class.border-white]="i === currentImageIndex()"
            [class.border-gray-400]="i !== currentImageIndex()"
            [class.opacity-100]="i === currentImageIndex()"
            [class.opacity-60]="i !== currentImageIndex()"
          >
            <img
              [src]="image.url"
              [alt]="image.alt"
              class="w-full h-full object-cover hover:scale-110 transition-transform duration-300"
            >
          </button>
        </div>
      </div>

      <!-- Project Information Section -->
      <div class="project-info-section p-8 lg:p-12 pb-20 lg:pb-24 bg-white dark:bg-gray-800">
        
        <!-- Header Info -->
        <div class="mb-8">
          <div class="flex items-start justify-between mb-4">
            <div class="flex-1">
              <h1 class="text-3xl lg:text-4xl font-bold gradient-text mb-2">
                {{ project.title }}
              </h1>
              <div class="flex items-center gap-4 text-gray-600 dark:text-gray-300 mb-4">
                <span class="flex items-center gap-1">
                  <span class="text-lg">üìÖ</span>
                  {{ getTimeSince(project.createdAt) }}
                </span>
                <span class="flex items-center gap-1">
                  <span class="text-lg">üëÅÔ∏è</span>
                  {{ formatViews(project.stats.views) }} vistas
                </span>
                <span class="flex items-center gap-1">
                  <span class="text-lg">üíñ</span>
                  {{ formatViews(project.stats.likes) }} likes
                </span>
              </div>
            </div>
            
            <!-- Project Score -->
            <div class="text-center bg-gradient-to-br from-purple-500 to-blue-500 text-white p-4 rounded-xl shadow-lg">
              <div class="text-2xl font-bold">{{ getProjectScore(project) }}</div>
              <div class="text-sm opacity-90">{{ getProjectGrade(getProjectScore(project)) }}</div>
            </div>
          </div>

          <!-- Description -->
          <p class="text-lg text-gray-700 dark:text-gray-300 leading-relaxed">
            {{ project.description }}
          </p>
        </div>

        <!-- Technologies Section -->
        <div class="mb-8">
          <h3 class="text-xl font-semibold text-gray-900 dark:text-gray-100 mb-4 flex items-center gap-2">
            <span class="text-2xl">üõ†Ô∏è</span> Tecnolog√≠as Utilizadas
          </h3>
          <div class="flex flex-wrap gap-3">
            <span 
              *ngFor="let tech of project.technologies"
              class="tech-badge-modal"
              [class.frontend]="getTechnologyColor(tech).includes('blue')"
              [class.backend]="getTechnologyColor(tech).includes('green')"
              [class.database]="getTechnologyColor(tech).includes('purple')"
              [class.mobile]="getTechnologyColor(tech).includes('pink')"
            >
              <span class="mr-2">{{ getTechnologyIcon(tech) }}</span>
              {{ tech }}
            </span>
          </div>
        </div>

        <!-- Action Buttons -->
        <div class="flex flex-wrap gap-4 justify-center lg:justify-start">
          <button
            *ngIf="project.demoUrl"
            (click)="openExternalLink(project.demoUrl)"
            class="action-btn bg-gradient-to-r from-blue-500 to-purple-600 hover:from-blue-600 hover:to-purple-700"
          >
            <span class="mr-2">üöÄ</span>
            Ver Demo Live
          </button>
          
          <button
            *ngIf="project.repoUrl"
            (click)="openExternalLink(project.repoUrl)"
            class="action-btn bg-gradient-to-r from-gray-700 to-gray-900 hover:from-gray-800 hover:to-black"
          >
            <span class="mr-2">üìÇ</span>
            C√≥digo Fuente
          </button>
          
          <button
            (click)="toggleFavorite($event)"
            class="action-btn transition-all duration-300"
            [class.bg-gradient-to-r]="!isFavorite()"
            [class.from-green-500]="!isFavorite()"
            [class.to-emerald-600]="!isFavorite()"
            [class.hover:from-green-600]="!isFavorite()"
            [class.hover:to-emerald-700]="!isFavorite()"
            [class.bg-gradient-to-r]="isFavorite()"
            [class.from-red-500]="isFavorite()"
            [class.to-pink-600]="isFavorite()"
            [class.hover:from-red-600]="isFavorite()"
            [class.hover:to-pink-700]="isFavorite()"
            [class.animate-pulse]="isFavorite()"
          >
            <span class="mr-2" [class.animate-bounce]="isFavorite()">
              {{ isFavorite() ? '‚ù§Ô∏è' : 'ü§ç' }}
            </span>
            {{ isFavorite() ? 'En Favoritos' : 'Agregar a Favoritos' }}
          </button>
          
          <button
            (click)="openShareModal($event)"
            class="action-btn bg-gradient-to-r from-orange-500 to-red-600 hover:from-orange-600 hover:to-red-700"
          >
            <span class="mr-2">üîó</span>
            Compartir
          </button>
        </div>

        <!-- Navigation Hints -->
        <div class="mt-8 pt-6 mb-8 border-t border-gray-200 dark:border-gray-600 text-center text-sm text-gray-500 dark:text-gray-400">
          <p class="mb-4">Navegaci√≥n con teclado:</p>
          <div class="flex justify-center gap-6 text-xs text-gray-600 dark:text-gray-400 pb-6">
            <span><kbd class="kbd bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300">ESC</kbd> Cerrar</span>
            <span><kbd class="kbd bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300">‚Üê/‚Üí</kbd> Cambiar imagen</span>
            <span><kbd class="kbd bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300">‚Üë/‚Üì</kbd> Cambiar proyecto</span>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Share Modal -->
  <app-share-modal
    [project]="project"
    [isOpen]="isShareModalOpen()"
    (closeModal)="closeShareModal()"
    (shareCompleted)="onShareCompleted($event)"
  ></app-share-modal>
</div>